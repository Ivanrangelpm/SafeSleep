<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./css/style.css" rel="stylesheet" />
    <link href="./css/dashboard.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    <title>SafeSleep | Dashboard</title>
    <style>
      canvas {
          -moz-user-select: none;
          -webkit-user-select: none;
          -ms-user-select: none;
          user-select: none;
      }
  </style>
  </head>
  <body>
    <div class="header">
      <a><img src="./images/ssLogoExtended.png" alt="logo" class="logo" /></a>
      <ul class="navbar">
        <li><a href="./gerenciar.html">Gerenciar</a></li>
        <li><a class="paginaAtual" href="./dashboard.html">Incubadoras</a></li>
        <li><button>Sair</button></li>
      </ul>
    </div>
    <div class="main" id="main">
      <div class="graficos">
        <div id="sectionCanvas1">
          <section>
            <span>Temperatura das Incubadoras</span>
            <canvas id="temperaturaAll"></canvas>
          </section>
        </div>
        <div id="sectionCanvas2">
          <section class="cardSection">
            <span class="pieTitle">Incubadoras Disponíveis</span>
            <canvas id="incubadorasUso"></canvas>
          </section>
          <section class="cardSection">
            <span class="pieTitle">Bebês Vulneráveis</span>
            <canvas id="bebesCritico"></canvas>
          </section>
          <section class="cardSection">
            <span class="pieTitle">Taxa de Prematuridade</span>
            <canvas id="prematuridade"></canvas>
          </section>
        </div>
      </div>
      <div class="section" id="sectionInfos">
        <h1>Selecione as opções desejadas:</h1>
        <div class="opcoes">
          <button id="botaoGeral" onclick="btnGeral()">Geral</button>
          <button id="botaoRisco" onclick="btnRisco()">Em risco</button>
          <button id="botaoAlertas" onclick="btnAlertas()">Alertas</button>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="developers">
        <h3>Desenvolvedores da SafeSleep</h3>
        <ul>
          <li>Bruno Yuji Takahashi - 04241032</li>
          <li>Diego Crispim dos Santos Campos - 04241019</li>
          <li>Fabricio Prudente Ferreira - 04241070</li>
          <li>Ivan Rangel Pestana Marcolin - 04241013</li>
          <li>Lucas Tetsuo Nagasse - 04241066</li>
          <li>Matheus Yukio Makiyama - 04241061</li>
          <li>Renan Rocha Pacanaro - 04241004</li>
        </ul>
      </div>
      <div class="contact">
        <h3>Contatos</h3>
        <ul>
          <li>safesleep@gmail.com</li>
          <li>+55 11 99999-9999</li>
        </ul>
        <img src="./images/ssLogoName.png" class="logo" />
      </div>
    </div>
    <!-- <div id="alerta">
      <div class="box">
        <h1>Urgente!</h1>
        <button onclick="closeAlert()">X</button>
      </div>
      <div class="box">
        <img src="./images/alert.png" alt="Alerta">
        <span>
          Incubadoras com Temperatura Desregulada:
          <br>Incubadora N° 01;
          <br>Incubadora N° 03;
        </span>
      </div> 
    </div> -->
  </body>
</html>

<script>
  var totalIncubadoras = 4;
  var mainContent = `
  <h1>Selecione as opções desejadas:</h1>
  <div class="opcoes">
    <button id="botaoGeral" onclick="btnGeral()">Geral</button>
    <button id="botaoRisco" onclick="btnRisco()">Em risco</button>
    <button id="botaoAlertas" onclick="btnAlertas()">Alertas</button>
  </div>`;
  var btnApertado = "";

  function showSelect() {
    var selectContent = "";
    if (btnApertado == "geral") {
      for (var cont = 1; cont <= totalIncubadoras; cont++) {
        selectContent += `<option value="${cont}">Incubadora ${cont}</option>`;
      }
    } else if (btnApertado == "risco") {
      for (var cont = 1; cont <= totalIncubadoras; cont++) {
        if (cont == 1 || cont == 3) {
          selectContent += `<option value="${cont}">Incubadora ${cont}</option>`;
        }
      }
    }
    sectionInfos.innerHTML = `${mainContent}
    <hr/>
    <div class="section">
      <h2>Selecione a incubadora para ver informações adicionais:</h2>
      <div class="selecao">
        <label>
          <span>Selecione a incubadora:</span>
          <select id="selectIncubadora" onchange="verificar()">
            <option value="0" selected disabled>Selecione a incubadora</option>
            ${selectContent}
          </select>
        </label>
      </div>
    </div>`;
  }

  function btnGeral() {
    btnApertado = "geral";
    showSelect();
  }

  function btnRisco() {
    btnApertado = "risco";
    showSelect();
  }

  function btnAlertas() {
    btnApertado = "alertas";
    sectionInfos.innerHTML = `${mainContent}
      <div id='divResponse' class='section'>
        <section class="cardSection">
          <span class="pieTitle">Quantidade de Bebês com Risco de Adquirir Doenças</span>
          <canvas id='pieRisk'></canvas>
        </section>
      </div>
    `;

    var divPieRisk = document.getElementById('pieRisk').getContext('2d');
    divPieRisk.canvas.width = 1;
    divPieRisk.canvas.height = 1;

    var graficoPieRisk = new Chart(
        divPieRisk,
        {
            type: 'pie',
            data: {
                labels: ['Risco de Hipotermia', 'Risco de Hipertermia'],
                datasets: [{
                    data: [1, 1],
                    backgroundColor: [
                    '#003050',
                    '#19A7A8'
                    ]
                }]
            }
        }
    )
  }

  var temperatura_maxima = 0;
  var temperatura_minima = 0;

  function verificar() {
    var incubadora = selectIncubadora.value;
    var nomeDoBebe = "";
    var nomeDoResponsavel = "";
    var parentesco = "";
    var nomeDoMedico = "";
    var peso = 0;
    var idade = 0;
    var prematuridade = "";
    var temperatures = [];
    var maxTemperatures = [];
    var minTemperatures = [];

    sectionInfos.innerHTML = `${mainContent}
    <div id="divResponse" class="section">
      <span class='lineTitle'>Temperatura da Incubadora Nº${incubadora}</span>  
      <section id='lineSection'>
        <canvas id='incubadoraNum${incubadora}'></canvas>
      </section>
      <span id='kidInfo'></span>
    </div>`;

    if(incubadora == 1)
    {
      nomeDoBebe = 'Maria';
      nomeDoMedico = "Gustavo";
      nomeDoResponsavel = "Paulo";
      parentesco = "Pai";
      peso = 1.78;
      idade = 3;
      temperatures = [32.25, 32, 31.5, 31.25, 30, 31.1, 32.5];
      prematuridade = "Sim";
    } else if(incubadora == 2){
      nomeDoBebe = "Enzo";
      nomeDoMedico = "José";
      nomeDoResponsavel = "Lourdes";
      parentesco = "Mãe";
      peso = 1.4;
      idade = 1;
      temperatures = [33.25, 33.5, 33.3, 32.8, 33.3, 33.25, 32.4];
      prematuridade = "Não";
    } else if(incubadora == 3){
      nomeDoBebe = "Lucas";
      nomeDoMedico = "Ricardo";
      nomeDoResponsavel = "Vanessa";
      parentesco = "Mãe";
      peso = 1.66;
      idade = 1;
      temperatures = [32.6, 32.05, 31.7, 31.95, 31.3, 31.1, 30.5];
      prematuridade = "Sim"
    } else {
      nomeDoBebe = "Valentina";
      nomeDoMedico = "Douglas";
      nomeDoResponsavel = "Iris";
      parentesco = "Tia";
      peso = 2.41;
      idade = 4;
      temperatures = [31.4, 29.3, 30.25, 30.75, 30.9, 31.1, 30.1];
      prematuridade = "Sim"
    }

    
    
    /*
    Dias  |     < 1.5 kg     |  1.5 kg à 2.49 kg  |    >= 2.5 kg
          |      (col1)      |        (col2)      |      (col3)                  
    ----  |  --------------  |  ----------------  |    ---------
    1     |  33.5 à >= 35°C  |      32 à 34°C     |    31 à 34°C
    2     |     33 à 35°C    |    31.5 à 33.5°C   |  30.5 à 33.5°C
    3     |     33 à 34°C    |    31.2 à 33.4°C   |  30.1 à 33.2°C
    4     |     33 à 34°C    |     31 à 32.5°C    |  29.8 à 32.8°C
    5-14  |     33 à 34°C    |      31 à 33°C     |   29 à 32.5°C
    */


    if(peso < 1.5) {
      if(idade === 1) { temperatura_minima = 33.5; temperatura_maxima = 35; }
      else if(idade === 2) { temperatura_minima = 33; temperatura_maxima = 35; }
      else { temperatura_minima = 33; temperatura_maxima = 34; }
    }
    else if(peso < 2.5) {
      if(idade === 1) { temperatura_minima = 32; temperatura_maxima = 34; }
      else if(idade === 2) { temperatura_minima = 31.5; temperatura_maxima = 33.5; }
      else if(idade === 3) { temperatura_minima = 31.2; temperatura_maxima = 33.4; }
      else if(idade === 4) { temperatura_minima = 31; temperatura_maxima = 32.5; }
      else { temperatura_minima = 31; temperatura_maxima = 33; }
    } else {
      if(idade === 1) { temperatura_minima = 31; temperatura_maxima = 34; }
      else if(idade === 2) { temperatura_minima = 30.5; temperatura_maxima = 33.5; }
      else if(idade === 3) { temperatura_minima = 30.1; temperatura_maxima = 33.2; }
      else if(idade === 4) { temperatura_minima = 29.8; temperatura_maxima = 32.8; }
      else { temperatura_minima = 29; temperatura_maxima = 32.5; }
    }

    if(prematuridade == "Não"){
      temperatura_maxima -= 0.8;
      temperatura_minima -= 0.8;
    }

    for(var cont = 0; cont < 7; cont++){
      maxTemperatures[cont] = temperatura_maxima;
      minTemperatures[cont] = temperatura_minima;
    }
    
    gerarGraficoInc(
      `incubadoraNum${incubadora}`,
      temperatures,
      maxTemperatures,
      minTemperatures
    );

    kidInfo.innerHTML += `
      <strong>Criança: ${nomeDoBebe}</strong><br>
      Peso: ${peso} kg | Idade: ${idade} dias | Prematuro? ${prematuridade}<br>
      Responsável pela Criança: ${nomeDoResponsavel} | Parentesco: ${parentesco}<br>
      Médico Responsável: ${nomeDoMedico}
      `
    }
    

  // ========================================== GRÁFICOS ========================================== //
  
  function gerarGraficoInc(divId, temperature, max, min){
    var incubadoraElement = document.getElementById(divId).getContext('2d');
    incubadoraElement.canvas.parentNode.style.width = '1600px';
    incubadoraElement.canvas.parentNode.style.height = '400px';
    incubadoraElement.canvas.width = 4;
    incubadoraElement.canvas.height = 1;
    
    var chartIncubadora = new Chart(
        incubadoraElement,
        {
            type: 'line',
            data: {
                labels: ['10h', '11h', '12h', '13h', '14h', '15h', '16h'],
                datasets: [{
                    label: 'Temperatura da Incubadora (°C)',
                    data: temperature,
                    borderWidth: 4,
                    borderColor: '#415a74',
                    backgroundColor: 'transparent'
                },{
                    label: 'Temperatura Máxima (°C)',
                    data: max,
                    borderWidth: 4,
                    borderColor: '#003050',
                    backgroundColor: 'transparent',
                    pointRadius: 0
                },{
                    label: 'Temperatura Mínima (°C)',
                    data: min,
                    borderWidth: 4,
                    borderColor: '#19A7A8',
                    backgroundColor: 'transparent',
                    pointRadius: 0
                }]
            },
            options: {
              scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: false,
                        min: Number(temperatura_minima.toFixed(0)) - 2,
                        max: Number(temperatura_maxima.toFixed(0)) + 2
                    }
                }]
              }
            }
        }
    )
  }


//Temperatura de Todas as Incubadoras
var divTemperaturaAll = document.getElementById('temperaturaAll').getContext('2d');
divTemperaturaAll.canvas.parentNode.style.width = '1600px';
divTemperaturaAll.canvas.parentNode.style.height = '400px';
divTemperaturaAll.canvas.width = 4;
divTemperaturaAll.canvas.height = 1;

var graficoTemperaturaAll = new Chart(
divTemperaturaAll,
{
    type: 'bar',
    data: {
    labels: ['Incubadora 1', 'Incubadora 2', 'Incubadora 3', 'Incubadora 4'],
    datasets: [{
        data: [32.5, 31.4, 30.5, 30.1],
        backgroundColor: '#003050',
        label: 'Temperatura de Cada Incubadora (°C)'
    }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    min: 26,
                    max: 38
                }
            }]
        }
    }
}
)

//Incubadoras em Uso
var divIncubadorasUso = document.getElementById('incubadorasUso').getContext('2d');
divIncubadorasUso.canvas.width = 1;
divIncubadorasUso.canvas.height = 1;

var graficoIncubadorasUso = new Chart(
    divIncubadorasUso,
    {
        type: 'pie',
        data: {
            labels: ['Livres', 'Em uso', 'Manutenção'],
            datasets: [{
                data: [1, 3, 1],
                backgroundColor: [
                '#19A7A8',
                '#003050',
                '#507090'
                ],
                label: 'Quantidade de Incubadoras'
            }]
        },
        options: {
            plugins: {
                subtitle: {
                    display: true,
                    text: 'Ola'
                }
            }
        }
    }
)

//Bebês com Risco
var divBebesCritico = document.getElementById('bebesCritico').getContext('2d');
divBebesCritico.canvas.width = 1;
divBebesCritico.canvas.height = 1;

var graficoBebesCritico = new Chart(
    divBebesCritico,
    {
        type: 'pie',
        data: {
            labels: ['Com Risco', 'Sem Risco'],
            datasets: [{
                data: [2, 3],
                backgroundColor: [
                    '#003050',
                    '#19A7A8'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                title: {
                    display: true,
                    text: "Algo random"
                }
            }
        }
    }
)

//Prematuridade
var divPrematuridade = document.getElementById('prematuridade').getContext('2d');
divPrematuridade.canvas.width = 1;
divPrematuridade.canvas.height = 1;

var graficoPrematuridade = new Chart(
    divPrematuridade,
    {
        type: 'pie',
        data: {
            labels: ['Prematuro', 'Não Prematuro'],
            datasets: [{
                data: [1, 4],
                backgroundColor: [
                '#82FAF9',
                '#507090'
                ]
            }]
        }
    }
)
</script>